<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Check-in sự kiện</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/css/dashboard.css" />
  <link rel="stylesheet" href="/assets/css/checkin.css" />
</head>
<body>
  <div class="trang-ch">
    <%- include('partials/header') %>
    <%- include('partials/menu') %>

    <div class="main-content" id="mainContent">
      <div class="page-header">
        <h1 class="page-title">Check-in sự kiện</h1>
        <a href="/attendant" class="back-btn"> ← </a>
      </div>

      <!-- THANH TÌM KIẾM + DROPDOWN CÙNG 1 HÀNG -->
      <div class="search-row">
        <div class="search-container">
          <input type="text" id="searchInput" class="search-box" placeholder="Tìm kiếm theo tên/ MSSV để check-in..." autocomplete="off">
          <div class="search-icon">
            <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
          </div>
        </div>

        <div class="event-select" id="eventSelect">
          <div class="event-label">
            <span id="eventLabel">Tất cả các sự kiện</span>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="dropdown-icon">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </div>
          <ul class="event-menu">
            <li>Ứng dụng AI nâng cao chất lượng trong công việc</li>
            <li>Nâng cao năng lực trong thời đại chuyển đổi số</li>
            <li>Khám phá các ứng dụng tiềm năng của ChatGPT</li>
            <li>Lập kế hoạch kinh doanh trên 1 trang giấy</li>
          </ul>
        </div>
      </div>

      <div class="student-list" id="studentList">
        <!-- JS fill khi tìm kiếm -->
      </div>
    </div>
  </div>
  <script>
    const students = [
      { name: "Trần Thị B", email: "ttb@example.com", mssv: "221121514232", event: "Nâng cao năng lực trong thời đại chuyển đổi số" },
      { name: "Trần Văn G", email: "tvg@example.com", mssv: "221121514227", event: "Nâng cao năng lực trong thời đại chuyển đổi số" },
      { name: "Trần Quốc F", email: "tqf@example.com", mssv: "221121514226", event: "Nâng cao năng lực trong thời đại chuyển đổi số", checked: true },
      { name: "Nguyễn Văn A", email: "nva@example.com", mssv: "221121514233", event: "Ứng dụng AI nâng cao chất lượng trong công việc" },
    ];
  
    const searchInput = document.getElementById("searchInput");
    const studentList = document.getElementById("studentList");
  
    // HÀM RENDER DANH SÁCH – HOÀN CHỈNH VÀ KHÔNG LỖI
    function renderStudents(data) {
      studentList.innerHTML = "";
  
      data.forEach((student, i) => {
        const item = document.createElement("div");
        item.className = `student-item ${student.checked ? 'checked' : ''}`;
  
        item.innerHTML = `
          <div class="student-info">
            <h3>${student.name}</h3>
            <p>${student.email} - MSSV: ${student.mssv}</p>
            <p class="student-event">${student.event}</p>
          </div>
          <button class="checkin-btn ${student.checked ? 'checked' : ''}">
            <span class="check-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            </span>
            <span>${student.checked ? 'Đã check-in' : 'Check-in'}</span>
          </button>
        `;
  
        studentList.appendChild(item);
  
        // Hiệu ứng fade-in mượt
        setTimeout(() => item.classList.add("show"), i * 80);
      });
  
      // GẮN SỰ KIỆN CLICK SAU KHI ĐÃ RENDER XONG
      document.querySelectorAll(".checkin-btn").forEach(btn => {
        btn.onclick = function () {
          const card = this.closest(".student-item");
          const willBeChecked = !this.classList.contains("checked");
  
          // Toggle chính xác trạng thái
          this.classList.toggle("checked", willBeChecked);
          card.classList.toggle("checked", willBeChecked);
  
          // Cập nhật text
          this.querySelector("span:last-child").textContent = willBeChecked ? "Đã check-in" : "Check-in";
        };
      });
    }

  
    // TÌM KIẾM LIVE + KHI XÓA SẼ HIỆN LẠI TOÀN BỘ
    searchInput.addEventListener("input", function () {
      const query = this.value.trim().toLowerCase();
  
      if (query === "") {
        renderStudents(students);
        return;
      }
  
      const filtered = students.filter(s =>
        s.name.toLowerCase().includes(query) ||
        s.mssv.includes(query)
      );
  
      renderStudents(filtered);
    });
  
    // DROPDOWN SỰ KIỆN
    const eventSelect = document.getElementById("eventSelect");
    const eventLabel = document.getElementById("eventLabel");
  
    eventSelect.addEventListener("click", () => eventSelect.classList.toggle("open"));
  
    eventSelect.querySelectorAll(".event-menu li").forEach(li => {
      li.addEventListener("click", () => {
        eventLabel.textContent = li.textContent;
        eventSelect.classList.remove("open");
      });
    });
  
    document.addEventListener("click", e => {
      if (!eventSelect.contains(e.target)) {
        eventSelect.classList.remove("open");
      }
    });
  </script>
</body>
</html>